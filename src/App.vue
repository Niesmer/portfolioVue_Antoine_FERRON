<template>
  <div class="">

    <header class="mb px-4 w-full z-10 sticky top-0">
      <RouterLink to="/" class="flex border-b-2 bg-[#FFF1E4] z-20 relative border-[#D75A00] pt-4 pb-4 gap-[5vw]">
        <svg width="100%" height="100%" viewBox="0 0 600 92" version="1.1" xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/"
          style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
          <g transform="matrix(1,0,0,1,-1187.71,-1303.65)">
            <g transform="matrix(0.0362382,0,0,0.0376372,1163.3,1252.75)">
              <path
                d="M3410.62,3718.92L2415.69,1415.13L1675.28,1415.13L673.75,3718.92L1440.6,3718.92L1576.12,3355.27L2508.24,3355.27L2640.45,3718.92L3410.62,3718.92ZM2045.49,2096.14L2319.83,2839.97L1767.83,2839.97L2045.49,2096.14Z"
                style="fill-rule:nonzero;" />
              <path
                d="M5245.8,2681.06L4197.46,1415.13L3553.18,1415.13L3553.18,3718.92L4256.92,3718.92L4256.92,2443.08L5308.57,3718.92L5952.85,3718.92L5952.85,1415.13L5245.8,1415.13L5245.8,2681.06Z"
                style="fill-rule:nonzero;" />
              <path
                d="M7661.99,3718.92L7661.99,1993.25L8468.63,1993.25L8468.63,1415.13L6135.08,1415.13L6135.08,1993.25L6948.33,1993.25L6948.33,3718.92L7661.99,3718.92Z"
                style="fill-rule:nonzero;" />
              <path
                d="M9943.26,3781.73C10829.3,3781.73 11348.1,3306.03 11348.1,2568.68C11348.1,1824.72 10839.2,1352.32 9943.26,1352.32C9060.5,1352.32 8538.47,1831.33 8538.47,2568.68C8538.47,3302.72 9060.5,3781.73 9943.26,3781.73ZM9943.26,3203.62C9480.3,3203.62 9242.21,2962.21 9242.21,2568.68C9242.21,2175.15 9480.3,1930.43 9943.26,1930.43C10406.2,1930.43 10637.7,2178.46 10637.7,2568.68C10637.7,2955.59 10406.2,3203.62 9943.26,3203.62Z"
                style="fill-rule:nonzero;" />
              <rect x="11573.3" y="1415.13" width="713.659" height="2303.79" style="fill-rule:nonzero;" />
              <path
                d="M14287.4,2681.06L13239.1,1415.13L12594.8,1415.13L12594.8,3718.92L13298.5,3718.92L13298.5,2443.08L14350.2,3718.92L14994.5,3718.92L14994.5,1415.13L14287.4,1415.13L14287.4,2681.06Z"
                style="fill-rule:nonzero;" />
              <path
                d="M17229.2,3718.92L17229.2,3206.92L16006.1,3206.92L16006.1,2816.41L17166.4,2816.41L17166.4,2301.11L16006.1,2301.11L16006.1,1927.13L17229.2,1927.13L17229.2,1415.13L15302.3,1415.13L15302.3,3718.92L17229.2,3718.92Z"
                style="fill-rule:nonzero;" />
            </g>
          </g>
        </svg>
        <svg width="100%" height="100%" viewBox="0 0 600 92" version="1.1" xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/"
          style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
          <g transform="matrix(1,0,0,1,-1187.71,-1413.47)">
            <g transform="matrix(0.0400444,0,0,0.0376372,1153.98,1362.57)">
              <path
                d="M1546.09,3718.92L1546.09,2915.59L2759.35,2915.59L2759.35,2400.28L1546.09,2400.28L1546.09,1927.13L2927.95,1927.13L2927.95,1415.13L842.35,1415.13L842.35,3718.92L1546.09,3718.92Z"
                style="fill-rule:nonzero;" />
              <path
                d="M5063.56,3718.92L5063.56,3206.92L3840.38,3206.92L3840.38,2816.41L5000.75,2816.41L5000.75,2301.11L3840.38,2301.11L3840.38,1927.13L5063.56,1927.13L5063.56,1415.13L3136.64,1415.13L3136.64,3718.92L5063.56,3718.92Z"
                style="fill-rule:nonzero;" />
              <g transform="matrix(1.07668,0,0,1,-410.375,0)">
                <path
                  d="M7186.21,2859.45C7457.14,2763.66 7638.85,2562.16 7638.85,2162.04C7638.85,1524.14 7153.17,1415.13 6617.6,1415.13L5351.59,1415.13L5351.59,3718.92L6052.02,3718.92L6052.02,2938.73L6491.91,2938.73L6938.41,3718.92L7728.11,3718.92L7186.21,2859.45ZM6587.83,1927.13C6723.44,1927.13 6931.8,1933.74 6931.8,2168.66C6931.8,2416.81 6720.13,2423.43 6587.83,2423.43L6052.02,2423.43L6052.02,1927.13L6587.83,1927.13Z"
                  style="fill-rule:nonzero;" />
              </g>
              <g transform="matrix(1.07668,0,0,1,-410.375,0)">
                <path
                  d="M9751.58,2859.45C10022.5,2763.66 10204.2,2562.16 10204.2,2162.04C10204.2,1524.14 9718.54,1415.13 9182.97,1415.13L7916.96,1415.13L7916.96,3718.92L8617.4,3718.92L8617.4,2938.73L9057.29,2938.73L9503.78,3718.92L10293.5,3718.92L9751.58,2859.45ZM9153.2,1927.13C9288.81,1927.13 9497.18,1933.74 9497.18,2168.66C9497.18,2416.81 9285.5,2423.43 9153.2,2423.43L8617.4,2423.43L8617.4,1927.13L9153.2,1927.13Z"
                  style="fill-rule:nonzero;" />
              </g>
              <g transform="matrix(0.904563,0,0,1,1274.25,0)">
                <path
                  d="M11794.6,3781.73C12680.6,3781.73 13199.4,3306.03 13199.4,2568.68C13199.4,1824.72 12690.6,1352.32 11794.6,1352.32C10911.8,1352.32 10389.8,1831.33 10389.8,2568.68C10389.8,3302.72 10911.8,3781.73 11794.6,3781.73ZM11794.6,3203.62C11331.6,3203.62 11093.5,2962.21 11093.5,2568.68C11093.5,2175.15 11331.6,1930.43 11794.6,1930.43C12257.5,1930.43 12489,2178.46 12489,2568.68C12489,2955.59 12257.5,3203.62 11794.6,3203.62Z"
                  style="fill-rule:nonzero;" />
              </g>
              <path
                d="M15117.2,2681.06L14068.9,1415.13L13424.6,1415.13L13424.6,3718.92L14128.3,3718.92L14128.3,2443.08L15180,3718.92L15824.2,3718.92L15824.2,1415.13L15117.2,1415.13L15117.2,2681.06Z"
                style="fill-rule:nonzero;" />
            </g>
          </g>
        </svg>
      </RouterLink>
      <div>
        <nav ref="nav" class="uppercase pt-4 pb-2 flex gap-4 border-b border-[#D75A00] bg-[#FFF1E4]">
          <div class="grid">
            <RouterLink to="/informations">Informations</RouterLink>
            <RouterLink to="/">Projets</RouterLink>
          </div>
        </nav>
      </div>
    </header>
    <SlideTransition :projectTitle="chosenProject"/>
    <RouterView v-slot="{ Component }">
        <component v-if="Component" :is="Component" />
    </RouterView>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onBeforeUnmount, Transition, type VNodeRef } from 'vue';
import { gsap } from 'gsap';
import { RouterLink, RouterView } from 'vue-router';
import SlideTransition from './components/SlideTransition.vue';
import { storeToRefs } from 'pinia';
import { useProjectStore } from './store/globalStore';
import { ScrollTrigger } from 'gsap/all';
gsap.registerPlugin(ScrollTrigger);


const nav = ref<HTMLElement | null>(null);
let navAnimationStarted = false;

const store = useProjectStore();

const { chosenProject, isAnimating } = storeToRefs(store)



onMounted(() => {
  ScrollTrigger.create({
    start: 0,
    end: window.innerHeight,
    trigger: document.body, // Attach ScrollTrigger globally
    onUpdate: (self) => {
      if (nav.value) {
        if (self.direction === 1) {
          if (self.direction === 1 && navAnimationStarted) {
            return;
          }
          // Scrolling down, hide the navigation bar
          navAnimationStarted = true;
          gsap.to(nav.value, {
            y: -nav.value.offsetHeight,
            height:0,
            overflow:"hidden",
            duration: 0.5,
            ease: 'power2.inOut',
            overwrite: 'auto', // Ensure only relevant animations run
            onComplete: () => {
              navAnimationStarted = false;
            },
          });
        } else if (self.direction === -1) {
          if (self.direction === -1 && navAnimationStarted) {
            return;
          }
          // Scrolling up, show the navigation bar
          navAnimationStarted = true;
          gsap.to(nav.value, {
            y: 0,
            height:'auto',
            overflow:"auto",
            duration: 0.3,
            ease: 'power2.inOut',
            overwrite: 'auto',
            onComplete: () => {
              navAnimationStarted = false;
            },
          });
        }
      }
    },
    fastScrollEnd: true, // Immediately detect end of scrolling
  });
});

onBeforeUnmount(() => {
  ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
});
</script>

<style scoped>
.router-link-active {
  font-weight: 700;
}
</style>